$(document).ready(function(){var t=1050,e=660,a=20,r=30,n=80,l=40,s=50,o=d3.select("div#svg").append("svg").attr("width",t).attr("height",e);d3.tsv("data/localDENovartis_Apps_Compliance-20_InTime_Percent.txt",function(i,c){function p(){var t=x.invert(d3.mouse(this)[0]),a=[];for(key in m){var s=m[key].values,o=bisectDate(s,t,1),i=s[o-1],c=s[o];d=t-i.date>c.date-t?c:i,a.push(d)}var p=[],u,f,h=new Array(12);h[0]="Jan",h[1]="Feb",h[2]="Mar",h[3]="Apr",h[4]="May",h[5]="Jun",h[6]="Jul",h[7]="Aug",h[8]="Sep",h[9]="Oct",h[10]="Nov",h[11]="Dec",$("circle").each(function(t){$(this).attr("transform","translate("+(l+x(a[t].date))+","+(r+k(a[t].number))+")"),u=$(this).attr("fill"),f=$(this).attr("name"),circleDate=h[a[t].date.getUTCMonth()]+" "+a[t].date.getFullYear(),p.push({color:u,name:f,date:circleDate,number:a[t].number})}),p.sort(function(t,e){return e.number-t.number}),F.html(""),F.append("<tr><td>"+p[0].date+"</td></tr>");for(var o=0;o<p.length;o++)F.append("<tr><td><span class='color' style='background-color:"+p[o].color+"'></span><span>"+p[o].name+"</span></td><td class='value'>"+Number(p[o].number).toFixed(2)+"</td></tr>");M.attr("x1",l+x(a[0].date)).attr("x2",l+x(a[0].date)).attr("y1",r).attr("y2",e-n),Y.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY+"px")}var u=0,f=d3.time.format("%Y-%m").parse,h=[];for(var v in c[0])h.push(v);h.splice(0,1);for(var m=[],g=[],y=0;y<c.length;y++){for(var b=0;b<h.length;b++)g.push({date:f(h[b]),number:c[y][h[b]]}),Number(c[y][h[b]])>u&&(u=c[y][h[b]]);m.push({name:c[y]["Market Segments"],values:g}),g=[]}for(var y=0;y<h.length;y++)h[y]=f(h[y]);var x=d3.time.scale().domain(d3.extent(h,function(t){return t})).range([0,t-l-s]),_=d3.svg.axis().scale(x).orient("bottom"),k=d3.scale.linear().domain([0,u]).rangeRound([e-r-n-a,0]),A=d3.svg.axis().scale(k).orient("left");o.append("g").attr("class","no_line_axis").attr("transform","translate("+l+","+(e-a-n+10)+")").transition().duration(500).call(_),o.append("g").attr("class","axis").attr("transform","translate("+l+","+r+")").transition().duration(500).call(A);var D=d3.svg.line().x(function(t){return x(t.date)}).y(function(t){return k(t.number)}),T=d3.scale.category10(),N=o.selectAll(".item").data(m).enter().append("path");N.attr("class","line").attr("d",function(t){return D(t.values)}).attr("transform","translate("+l+","+r+")").style("stroke",function(t){return T(t.name)});for(var y=0;y<N[0].length;y++)d3.select(N[0][y]).attr("stroke-dasharray",N[0][y].getTotalLength()+" "+N[0][y].getTotalLength()).attr("stroke-dashoffset",N[0][y].getTotalLength()).transition().duration(500).ease("linear").attr("stroke-dashoffset",0);bisectDate=d3.bisector(function(t){return t.date}).left;var w=o.selectAll("svg").data(m).enter().append("circle").attr("fill",function(t){return T(t.name)}).attr("r",4).attr("display","none").attr("name",function(t){return t.name});o.selectAll("circle").attr("transform",function(t){return"translate("+(l+x(t.values.date))+","+(r+k(t.values.number))+")"});var M=o.append("line").attr("stroke-dasharray",10).attr("stroke","#a6a8ac").attr("stroke-width",.8).attr("display","none");o.append("rect").attr("width",t-s-l).attr("height",e-n-r).attr("fill","none").attr("pointer-events","all").attr("transform","translate("+l+","+r+")").on("mouseover",function(){w.attr("display",null),M.attr("display",null),Y.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mouseout",function(){w.attr("display","none"),M.attr("display","none"),Y.style("opacity",0)}).on("mousemove",p);var Y=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),C="<table><tbody></tbody></table>";Y.html(C);var F=$("div.tooltip tbody")}),$.ajax({url:"data/localDENovartis_Apps_Compliance-20_InTime_Percent.txt",success:function(t){for(var e="",a="",r=t.split("\n"),n=0;n<r.length;n++){var l=r[n].split("	");if(e="",a="",0==n){for(var s,o=0;o<l.length;o++)s=l[0],o<l.length/2?e=e+"<th>"+l[o]+"</th>":a=a+"<th>"+l[o]+"</th>";a="<th>"+s+"</th>"+a,$("table#first_half thead").append("<tr>"+e+"</tr>"),$("table#second_half thead").append("<tr>"+a+"</tr>")}else{for(var s,o=0;o<l.length;o++)s=l[0],o<l.length/2?e=e+"<td>"+l[o]+"</td>":a=a+"<td>"+l[o]+"</td>";a="<td>"+s+"</td>"+a,$("table#first_half tbody").append("<tr>"+e+"</tr>"),$("table#second_half tbody").append("<tr>"+a+"</tr>")}}}})});