$(document).ready(function(){var t=1050,e=660,a=10,r=20,n=80,l=40,s=50,u=d3.select("div#svg").append("svg").attr("width",t).attr("height",e);d3.tsv("data/localDENovartis_Apps_SoB-12_ALPHACYN_Month.txt",function(o,v){var d,i,m,p,c=[],b=[],f=[],h=d3.scale.category10(),g,y=0,x=0,c=[];for(var _ in v[0])c.push(_);c.splice(0,1);for(var b=[],A=[],N=0,M=0,Y=0;Y<c.length;Y++){for(var k=0;k<v.length;k++)Number(v[k][c[Y]])>=0?N+=Number(v[k][c[Y]]):M+=Number(v[k][c[Y]]),A.push({name:v[k].Components,number:Number(v[k][c[Y]])});var w=[];w.name=A[7].name,w.number=A[7].number,A[7].name=A[0].name,A[7].number=A[0].number,A[0].name=w.name,A[0].number=w.number,N>y&&(y=N),x>M&&(x=M),N=0,M=0,b.push({date:c[Y],values:A}),A=[]}console.log(b);var d=d3.scale.ordinal().domain(c).rangeRoundBands([0,t-l-s]),i=d3.svg.axis().scale(d).orient("bottom");x=100*Math.round(x/100),y=100*Math.ceil(y/100);var m=d3.scale.linear().domain([x,y]).range([e-r-n,0]),B=d3.svg.axis().scale(m).tickValues(d3.range(x,y,200)).orient("left");u.append("g").attr("class","axis").attr("transform","translate("+l+","+(e-n-(e-r-n-m(0)))+")").transition().duration(500).call(i).selectAll("text").attr("y",70).attr("x",-56).attr("font-size","10px").attr("text-anchor","middle").attr("transform","rotate(-40)"),u.append("g").attr("class","axis").attr("transform","translate("+l+","+r+")").transition().duration(500).call(B);for(var h=d3.scale.category10(),C=u.selectAll("g.item").data(b).enter().append("g").attr("class","item"),D=(t-l-s)/b.length-a,k=0;k<b[0].values.length;k++)C.append("rect").attr("height",0).attr("y",function(t,a){var l=0,s=0,u=e-r-n-m(0);if(t.values[k].number>=0){for(var o=0;k>o;o++)t.values[o].number>0?l=l+e-r-n-m(t.values[o].number)-u:l+=0;return s=e-n-(e-r-n-m(0))-l}if(t.values[k].number<0){for(var o=0;k>o;o++)t.values[o].number<0?l=l+e-r-n-m(-1*t.values[o].number)-u:l+=0;return s=e-n-(e-r-n-m(0))+l}}).transition().duration(function(t){var a=e-r-n-m(0);return t.values[k].number>0?e-r-n-m(t.values[k].number)-a+100:t.values[k].number<0?e-r-n-m(-1*t.values[k].number)-a+100:0}).ease("swing").delay(function(t){var a=0,l=e-r-n-m(0);if(t.values[k].number>0){for(var s=0;k>s;s++)t.values[s].number>0&&(a=a+e-r-n-m(t.values[s].number)-l+100);return a}if(t.values[k].number<0){for(var s=0;k>s;s++)t.values[s].number<0&&(a=a+e-r-n-m(-1*t.values[s].number)-l+100);return a}return 0}).attr("x",function(t,e){return l+(2*e+1)*a/2+D*e}).attr("y",function(t,a){var l=0,s=0,u=e-r-n-m(0);if(t.values[k].number>=0){for(var o=0;k>=o;o++)t.values[o].number>0?l=l+e-r-n-m(t.values[o].number)-u:l+=0;return s=e-n-(e-r-n-m(0))-l}if(t.values[k].number<0){for(var o=0;k>o;o++)t.values[o].number<0?l=l+e-r-n-m(-1*t.values[o].number)-u:l+=0;return s=e-n-(e-r-n-m(0))+l}}).attr("fill",function(t){return h(t.values[k].name)}).attr("height",function(t,a){var l=e-r-n-m(0);return t.values[k].number>0?e-r-n-m(t.values[k].number)-l:t.values[k].number<0?e-r-n-m(-1*t.values[k].number)-l:0}).attr("width",function(t,e){return D});var E=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);E.html("<table><tbody></tbody></table>");var H=$("div.tooltip tbody");C.on("mouseover",function(t){H.html(""),H.append("<tr><td>Time: "+t.date+"</td></tr>");for(var e=[],a=[],r=0;r<t.values.length;r++)t.values[r].number>0?e.push(t.values[r]):a.push(t.values[r]);for(var r=e.length-1;r>=0;r--)H.append("<tr><td><span class='color' style='background-color:"+h(e[r].name)+"'></span><span>"+e[r].name+"</span></td><td class='value'>"+e[r].number+"</td></tr>");for(var r=0;r<a.length;r++)H.append("<tr><td><span class='color' style='background-color:"+h(a[r].name)+"'></span><span>"+a[r].name+"</span></td><td class='value'>"+a[r].number+"</td></tr>");E.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mousemove",function(t){E.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){E.style("opacity",0)})}),$.ajax({url:"data/localDENovartis_Apps_SoB-12_ALPHACYN_Month.txt",success:function(t){for(var e="",a="",r=t.split("\n"),n=0;n<r.length;n++){var l=r[n].split("	");if(e="",a="",0==n){for(var s,u=0;u<l.length;u++)s=l[0],u<l.length/2?e=e+"<th>"+l[u]+"</th>":a=a+"<th>"+l[u]+"</th>";a="<th>"+s+"</th>"+a,$("table#first_half thead").append("<tr>"+e+"</tr>"),$("table#second_half thead").append("<tr>"+a+"</tr>")}else{for(var s,u=0;u<l.length;u++)s=l[0],u<l.length/2?e=e+"<td>"+l[u]+"</td>":a=a+"<td>"+l[u]+"</td>";a="<td>"+s+"</td>"+a,$("table#first_half tbody").append("<tr>"+e+"</tr>"),$("table#second_half tbody").append("<tr>"+a+"</tr>")}}}})});