$(document).ready(function(){var t=1050,e=660,a=10,n=30,r=80,l=0,s=50,o=d3.select("div#svg").append("svg").attr("width",t).attr("height",e);d3.tsv("data/localDENovartis_Apps_Compliance-20_Ranges_Percent.txt",function(d,i){var u=0,c=[];for(var p in i[0])c.push(p);c.splice(0,1);for(var v=[],f=[],h=0,g=0;g<c.length;g++){for(var m=0;m<i.length;m++)h+=Number(i[m][c[g]]),f.push({name:i[m]["Market Segments"],number:Number(i[m][c[g]])});h>u&&(u=h),h=0,v.push({range:c[g],values:f}),f=[]}var b=d3.scale.ordinal().domain(c).rangeRoundBands([0,t-l-s]),y=d3.svg.axis().scale(b).orient("bottom"),x=d3.scale.linear().domain([0,u]).rangeRound([e-n-r,0]),_=d3.svg.axis().scale(x).orient("left");o.append("g").attr("class","axis").attr("transform","translate("+l+","+(e-r)+")").transition().duration(500).call(y).selectAll("text").attr("y",15);for(var Y=d3.scale.category10(),R=o.selectAll("body").data(v).enter().append("g").attr("class","item"),A=[],N=(t-l-s)/v.length-a,m=0;m<v[0].values.length;m++)R.append("rect").attr("height",0).attr("y",function(t,a){for(var l=0,s=0;m>s;s++)l+=e-n-r-x(t.values[s].number);return rectY=e-r-l,rectY}).transition().duration(function(t){var a=e-n-r-x(t.values[m].number);return a+50}).ease("liner").delay(function(t){for(var a=0,l=0;m>l;l++)a=a+(e-n-r-x(t.values[l].number))+50;return a}).attr("x",function(t,e){return l+(2*e+1)*a/2+N*e}).attr("y",function(t,a){for(var l=0,s=0;m>=s;s++)l+=e-n-r-x(t.values[s].number);return rectY=e-r-l,rectY}).attr("fill",function(t,e){return Y(t.values[m].name)}).attr("height",function(t,a){return e-n-r-x(t.values[m].number)}).attr("width",function(t,e){return N});var k=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);k.html("<table><tbody></tbody></table>");var w=$("div.tooltip tbody");R.on("mouseover",function(t){var e=$("g.item").index(this);w.html(""),w.append("<tr><td>Range: "+v[e].range+"</td></tr>");for(var a=0;a<v[e].values.length;a++)w.append("<tr><td><span class='color' style='background-color:"+Y(v[e].values[a].name)+"'></span><span>"+v[e].values[a].name+"</span></td><td class='value'>"+(100*v[e].values[a].number).toFixed(1)+"%</td></tr>");k.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY+"px").style("opacity",1)}).on("mousemove",function(t){k.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY+"px")}).on("mouseout",function(t){k.style("opacity",0)})}),$.ajax({url:"data/localDENovartis_Apps_Compliance-20_Ranges_Percent.txt",success:function(t){for(var e="",a="",n=t.split("\n"),r=0;r<n.length;r++){var l=n[r].split("	");if(e="",a="",0==r){for(var s,o=0;o<l.length;o++)s=l[0],o<l.length/2?e=e+"<th>"+l[o]+"</th>":a=a+"<th>"+l[o]+"</th>";a="<th>"+s+"</th>"+a,$("table#first_half thead").append("<tr>"+e+"</tr>"),$("table#second_half thead").append("<tr>"+a+"</tr>")}else{for(var s,o=0;o<l.length;o++)s=l[0],o<l.length/2?e=e+"<td>"+l[o]+"</td>":a=a+"<td>"+l[o]+"</td>";a="<td>"+s+"</td>"+a,$("table#first_half tbody").append("<tr>"+e+"</tr>"),$("table#second_half tbody").append("<tr>"+a+"</tr>")}}}})});