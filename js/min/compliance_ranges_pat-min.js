$(document).ready(function(){var t=1050,a=660,e=10,r=30,n=80,l=50,s=50,o=d3.select("div#svg").append("svg").attr("width",t).attr("height",a);d3.tsv("data/localDENovartis_Apps_Compliance-20_Ranges_Pat.txt",function(d,i){var u=0,p=[];for(var c in i[0])p.push(c);p.splice(0,1);for(var v=[],f=[],h=0,g=0;g<p.length;g++){for(var m=0;m<i.length;m++)h+=Number(i[m][p[g]]),f.push({name:i[m]["Market Segments"],number:Number(i[m][p[g]])});h>u&&(u=h),h=0,v.push({range:p[g],values:f}),f=[]}var b=d3.scale.ordinal().domain(p).rangeRoundBands([0,t-l-s]),y=d3.svg.axis().scale(b).orient("bottom"),x=d3.scale.linear().domain([0,u]).rangeRound([a-r-n,0]),_=d3.svg.axis().scale(x).orient("left");o.append("g").attr("class","axis").attr("transform","translate("+l+","+(a-n)+")").transition().duration(500).call(y).selectAll("text").attr("y",15),o.append("g").attr("class","axis").attr("transform","translate("+l+","+r+")").transition().duration(500).call(_);for(var Y=d3.scale.category10(),R=o.selectAll("body").data(v).enter().append("g").attr("class","item"),A=[],N=(t-l-s)/v.length-e,m=0;m<v[0].values.length;m++)R.append("rect").attr("height",0).attr("y",function(t,e){for(var l=0,s=0;m>s;s++)l+=a-r-n-x(t.values[s].number);return rectY=a-n-l,rectY}).transition().duration(function(t){var e=a-r-n-x(t.values[m].number);return e+50}).ease("liner").delay(function(t){for(var e=0,l=0;m>l;l++)e=e+(a-r-n-x(t.values[l].number))+50;return e}).attr("x",function(t,a){return l+(2*a+1)*e/2+N*a}).attr("y",function(t,e){for(var l=0,s=0;m>=s;s++)l+=a-r-n-x(t.values[s].number);return rectY=a-n-l,rectY}).attr("fill",function(t,a){return Y(t.values[m].name)}).attr("height",function(t,e){return a-r-n-x(t.values[m].number)}).attr("width",function(t,a){return N});var k=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);k.html("<table><tbody></tbody></table>");var w=$("div.tooltip tbody");R.on("mouseover",function(t){var a=$("g.item").index(this);w.html(""),w.append("<tr><td>Range: "+v[a].range+"</td></tr>");for(var e=0;e<v[a].values.length;e++)w.append("<tr><td><span class='color' style='background-color:"+Y(v[a].values[e].name)+"'></span><span>"+v[a].values[e].name+"</span></td><td class='value'>"+v[a].values[e].number+"</td></tr>");k.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY+"px").style("opacity",1)}).on("mousemove",function(t){k.style("left",d3.event.pageX+20+"px").style("top",d3.event.pageY+"px")}).on("mouseout",function(t){k.style("opacity",0)})}),$.ajax({url:"data/localDENovartis_Apps_Compliance-20_Ranges_Pat.txt",success:function(t){for(var a="",e="",r=t.split("\n"),n=0;n<r.length;n++){var l=r[n].split("	");if(a="",e="",0==n){for(var s,o=0;o<l.length;o++)s=l[0],o<l.length/2?a=a+"<th>"+l[o]+"</th>":e=e+"<th>"+l[o]+"</th>";e="<th>"+s+"</th>"+e,$("table#first_half thead").append("<tr>"+a+"</tr>"),$("table#second_half thead").append("<tr>"+e+"</tr>")}else{for(var s,o=0;o<l.length;o++)s=l[0],o<l.length/2?a=a+"<td>"+l[o]+"</td>":e=e+"<td>"+l[o]+"</td>";e="<td>"+s+"</td>"+e,$("table#first_half tbody").append("<tr>"+a+"</tr>"),$("table#second_half tbody").append("<tr>"+e+"</tr>")}}}})});