function compliance_patientInCategory(){svg.selectAll("*").remove();var t=[{name:"low compliance",color:"#fbae3f"},{name:"fair compliance",color:"#40d47e"},{name:"over compliance",color:"#249a4b"}];legend=svg.selectAll("g.legend").data(t).enter().append("g").attr("class","legend"),legend.append("rect").attr("stroke",function(t,a){return t.color}).attr("fill",function(t,a){return t.color}).attr("x",w+margin.left+50).attr("y",function(t,a){return margin.top+20*a}).attr("width",20).attr("height",10).on("click",function(t){var a=t.color;"white"==$(this).attr("fill")?$(this).attr("fill",a):$(this).attr("fill","white")}),legend.append("text").attr("x",w+margin.left+80).attr("y",function(t,a){return margin.top+20*a}).attr("dominant-baseline","hanging").text(function(t,a){return t.name}),d3.tsv("data/localDENovartis_Apps_Compliance-20_Categories_Pat.txt",function(t,a){function e(){return d3.svg.axis().scale(d).orient("bottom")}var n=[];legend.selectAll("rect").each(function(t,a){"white"!=$(this).attr("fill")&&n.push(t.name)});for(var r=[],o={},i=0;i<a.length;i++){o=[];for(key in a[i])for(var l=0;l<n.length;l++)key==n[l]&&o.push({key:a[i][key]});r.push(o)}console.log(r);var s=d3.max(a,function(t){return Number(t["fair compliance"])})+d3.max(a,function(t){return Number(t["over compliance"])})+d3.max(a,function(t){return Number(t["low compliance"])}),c=d3.scale.linear().domain([0,s]).rangeRound([0,w]),d=d3.scale.linear().domain([0,s]).rangeRound([0,w]),p=d3.svg.axis().scale(d).orient("bottom").ticks(5).outerTickSize(0),m=d3.scale.ordinal().domain(a.map(function(t){return t["Market Segments"].toLowerCase()})).rangeRoundBands([0,h]),u=d3.svg.axis().scale(m).orient("left");svg.append("g").attr("class","no_line_axis").attr("transform","translate("+margin.left+","+(h+margin.top)+")").transition().duration(500).call(p).selectAll("text").attr("y",20),svg.append("g").attr("class","axis yaxis").attr("transform","translate("+margin.left+","+margin.top+")").transition().duration(500).call(u),svg.append("g").attr("class","grid").attr("transform","translate("+margin.left+","+(margin.top+h)+")").call(e().tickSize(-h,0,0).tickFormat(""));var g=svg.selectAll("body").data(a).enter().append("g").attr("class","item");g.append("rect").attr("class","low_compliance").attr("width",0).transition().duration(250).ease("swing").delay(function(t,a){return 50*a}).attr("x",function(t,a){return margin.left}).attr("y",function(t,e){return h/a.length*e+margin.top}).attr("height",h/a.length-barPadding).attr("width",function(t,a){return c(t["low compliance"])}),g.append("rect").attr("class","fair_compliance").attr("width",0).transition().duration(250).ease("swing").delay(function(t,a){return 250+50*a}).attr("x",function(t,a){return margin.left+c(t["low compliance"])}).attr("y",function(t,e){return h/a.length*e+margin.top}).attr("height",h/a.length-barPadding).attr("width",function(t,a){return c(t["fair compliance"])}),g.append("rect").attr("class","over_compliance").attr("width",0).transition().duration(250).ease("swing").delay(function(t,a){return 500+50*a}).attr("x",function(t,a){return margin.left+c(t["low compliance"])+c(t["fair compliance"])}).attr("y",function(t,e){return h/a.length*e+margin.top}).attr("height",h/a.length-barPadding).attr("width",function(t,a){return c(t["over compliance"])});var f=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);g.on("mouseover",function(t){var a="<table><tbody><tr><td><span class='color low_compliance'></span><span>low compliance</span></td><td class='value'>"+t["low compliance"]+"</td></tr><tr><td><span class='color fair_compliance'></span><span>fair compliance</span></td><td class='value'>"+t["fair compliance"]+"</td></tr><tr><td><span class='color over_compliance'></span><span>over compliance</span></td><td class='value'>"+t["over compliance"]+"</td></tr></tbody></table>";f.html(a).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mousemove",function(t){f.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){f.style("opacity",0)})})}function compliance_percentInCategory(){svg.selectAll("*").remove(),d3.tsv("data/localDENovartis_Apps_Compliance-20_Categories_Percent.txt",function(t,a){var e=1,n=d3.scale.linear().domain([0,e]).rangeRound([0,w]),r=d3.scale.linear().domain([0,e]).rangeRound([0,w]),o=d3.scale.ordinal().domain(a.map(function(t){return t["Market Segments"].toLowerCase()})).rangeRoundBands([0,h]),i=d3.svg.axis().scale(o).orient("left");svg.append("g").attr("class","axis yaxis").attr("transform","translate("+margin.left+","+margin.top+")").transition().duration(500).call(i);var l=svg.selectAll("body").data(a).enter().append("g").attr("class","item");l.append("rect").attr("class","low_compliance").attr("width",0).transition().duration(250).ease("swing").delay(function(t,a){return 50*a}).attr("x",function(t,a){return margin.left}).attr("y",function(t,e){return h/a.length*e+margin.top}).attr("height",h/a.length-barPadding).attr("width",function(t,a){return n(t["low compliance"])}),l.append("rect").attr("class","fair_compliance").attr("width",0).transition().duration(250).ease("swing").delay(function(t,a){return 250+50*a}).attr("x",function(t,a){return margin.left+n(t["low compliance"])}).attr("y",function(t,e){return h/a.length*e+margin.top}).attr("height",h/a.length-barPadding).attr("width",function(t,a){return n(t["fair compliance"])}),l.append("rect").attr("class","over_compliance").attr("width",0).transition().duration(250).ease("swing").delay(function(t,a){return 500+50*a}).attr("x",function(t,a){return margin.left+n(t["low compliance"])+n(t["fair compliance"])}).attr("y",function(t,e){return h/a.length*e+margin.top}).attr("height",h/a.length-barPadding).attr("width",function(t,a){return n(t["over compliance"])});var s=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);l.on("mouseover",function(t){var a="<table><tbody><tr><td><span class='color low_compliance'></span><span>low compliance</span></td><td class='value'>"+(100*Number(t["low compliance"])).toFixed(2)+"%</td></tr><tr><td><span class='color fair_compliance'></span><span>fair compliance</span></td><td class='value'>"+(100*Number(t["fair compliance"])).toFixed(2)+"%</td></tr><tr><td><span class='color over_compliance'></span><span>over compliance</span></td><td class='value'>"+(100*Number(t["over compliance"])).toFixed(2)+"%</td></tr></tbody></table>";s.html(a).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mousemove",function(t){s.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){s.style("opacity",0)})})}function compliance_patientInTime(){svg.selectAll("*").remove(),d3.tsv("data/localDENovartis_Apps_Compliance-20_InTime_Rx.txt",function(t,a){function e(){return d3.svg.axis().scale(f).orient("left").ticks(8)}function n(){var t=u.invert(d3.mouse(this)[0]),a=[];for(key in s){var e=s[key].values,n=bisectDate(e,t,1),r=e[n-1],o=e[n];d=t-r.date>o.date-t?o:r,a.push(d)}var i=[],l,c,p=new Array(12);p[0]="Jan",p[1]="Feb",p[2]="Mar",p[3]="Apr",p[4]="May",p[5]="Jun",p[6]="Jul",p[7]="Aug",p[8]="Sep",p[9]="Oct",p[10]="Nov",p[11]="Dec",$("circle").each(function(t){$(this).attr("transform","translate("+(margin.left+u(a[t].date))+","+(margin.top+f(a[t].number))+")"),l=$(this).attr("fill"),c=$(this).attr("name"),circleDate=p[a[t].date.getUTCMonth()]+" "+a[t].date.getFullYear(),i.push({color:l,name:c,date:circleDate,number:a[t].number})}),i.sort(function(t,a){return a.number-t.number}),N.html(""),N.append("<tr><td>"+i[0].date+"</td></tr>");for(var n=0;n<i.length;n++)N.append("<tr><td><span class='color' style='background-color:"+i[n].color+"'></span><span>"+i[n].name+"</span></td><td class='value'>"+i[n].number+"</td></tr>");_.attr("x1",margin.left+u(a[0].date)).attr("x2",margin.left+u(a[0].date)).attr("y1",margin.top).attr("y2",h+margin.top),A.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}var r=0,o=d3.time.format("%Y-%m").parse,i=[];for(var l in a[0])i.push(l);i.splice(0,1);for(var s=[],c=[],p=0;p<a.length;p++){for(var m=0;m<i.length;m++)c.push({date:o(i[m]),number:a[p][i[m]]}),Number(a[p][i[m]])>r&&(r=a[p][i[m]]);s.push({name:a[p]["Market Segments"],values:c}),c=[]}for(var p=0;p<i.length;p++)i[p]=o(i[p]);var u=d3.time.scale().domain(d3.extent(i,function(t){return t})).range([0,w]),g=d3.svg.axis().scale(u).orient("bottom").outerTickSize(0),f=d3.scale.linear().domain([0,r]).rangeRound([h,0]),v=d3.svg.axis().scale(f).orient("left").outerTickSize(0);svg.append("g").attr("class","axis").attr("transform","translate("+margin.left+","+(h+margin.top)+")").transition().duration(500).call(g).selectAll("text").attr("y",30),svg.append("g").attr("class","no_line_axis").attr("transform","translate("+margin.left+","+margin.top+")").transition().duration(500).call(v),svg.append("g").attr("class","grid").call(e().tickSize(-w,0,0).tickFormat("")).attr("transform","translate("+margin.left+","+margin.top+")");var y=d3.svg.line().x(function(t){return u(t.date)}).y(function(t){return f(t.number)}),b=d3.scale.category10(),x=svg.selectAll(".item").data(s).enter().append("path");x.attr("class","line").attr("d",function(t){return y(t.values)}).attr("transform","translate("+margin.left+","+margin.top+")").style("stroke",function(t){return b(t.name)});for(var p=0;p<x[0].length;p++)d3.select(x[0][p]).attr("stroke-dasharray",x[0][p].getTotalLength()+" "+x[0][p].getTotalLength()).attr("stroke-dashoffset",x[0][p].getTotalLength()).transition().duration(500).ease("linear").attr("stroke-dashoffset",0);bisectDate=d3.bisector(function(t){return t.date}).left;var k=svg.selectAll("svg").data(s).enter().append("circle").attr("fill",function(t){return b(t.name)}).attr("r",4).attr("display","none").attr("name",function(t){return t.name});svg.selectAll("circle").attr("transform",function(t){return"translate("+(margin.left+u(t.values.date))+","+(margin.top+f(t.values.number))+")"});var _=svg.append("line").attr("stroke-dasharray",10).attr("stroke","#a6a8ac").attr("stroke-width",.8).attr("display","none");svg.append("rect").attr("width",w).attr("height",h).attr("fill","none").attr("pointer-events","all").attr("transform","translate("+margin.left+","+margin.top+")").on("mouseover",function(){k.attr("display",null),_.attr("display",null),A.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mouseout",function(){k.attr("display","none"),_.attr("display","none"),A.style("opacity",0)}).on("mousemove",n);var A=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),T="<table><tbody></tbody></table>";A.html(T);var N=$("div.tooltip tbody")})}function compliance_percentInTime(){svg.selectAll("*").remove(),d3.tsv("data/localDENovartis_Apps_Compliance-20_InTime_Percent.txt",function(t,a){function e(){return d3.svg.axis().scale(f).orient("left").ticks(8)}function n(){var t=u.invert(d3.mouse(this)[0]),a=[];for(key in s){var e=s[key].values,n=bisectDate(e,t,1),r=e[n-1],o=e[n];d=t-r.date>o.date-t?o:r,a.push(d)}var i=[],l,c,p=new Array(12);p[0]="Jan",p[1]="Feb",p[2]="Mar",p[3]="Apr",p[4]="May",p[5]="Jun",p[6]="Jul",p[7]="Aug",p[8]="Sep",p[9]="Oct",p[10]="Nov",p[11]="Dec",$("circle").each(function(t){$(this).attr("transform","translate("+(margin.left+u(a[t].date))+","+(margin.top+f(a[t].number))+")"),l=$(this).attr("fill"),c=$(this).attr("name"),circleDate=p[a[t].date.getUTCMonth()]+" "+a[t].date.getFullYear(),i.push({color:l,name:c,date:circleDate,number:a[t].number})}),i.sort(function(t,a){return a.number-t.number}),N.html(""),N.append("<tr><td>"+i[0].date+"</td></tr>");for(var n=0;n<i.length;n++)N.append("<tr><td><span class='color' style='background-color:"+i[n].color+"'></span><span>"+i[n].name+"</span></td><td class='value'>"+Number(i[n].number).toFixed(2)+"</td></tr>");_.attr("x1",margin.left+u(a[0].date)).attr("x2",margin.left+u(a[0].date)).attr("y1",margin.top).attr("y2",h+margin.top),A.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}var r=0,o=d3.time.format("%Y-%m").parse,i=[];for(var l in a[0])i.push(l);i.splice(0,1);for(var s=[],c=[],p=0;p<a.length;p++){for(var m=0;m<i.length;m++)c.push({date:o(i[m]),number:a[p][i[m]]}),Number(a[p][i[m]])>r&&(r=a[p][i[m]]);s.push({name:a[p]["Market Segments"],values:c}),c=[]}for(var p=0;p<i.length;p++)i[p]=o(i[p]);var u=d3.time.scale().domain(d3.extent(i,function(t){return t})).range([0,w]),g=d3.svg.axis().scale(u).orient("bottom").outerTickSize(0),f=d3.scale.linear().domain([0,r]).rangeRound([h,0]),v=d3.svg.axis().scale(f).orient("left").outerTickSize(0);svg.append("g").attr("class","axis").attr("transform","translate("+margin.left+","+(h+margin.top)+")").transition().duration(500).call(g).selectAll("text").attr("y",30),svg.append("g").attr("class","no_line_axis").attr("transform","translate("+margin.left+","+margin.top+")").transition().duration(500).call(v),svg.append("g").attr("class","grid").call(e().tickSize(-w,0,0).tickFormat("")).attr("transform","translate("+margin.left+","+margin.top+")");var y=d3.svg.line().x(function(t){return u(t.date)}).y(function(t){return f(t.number)}),b=d3.scale.category10(),x=svg.selectAll(".item").data(s).enter().append("path");x.attr("class","line").attr("d",function(t){return y(t.values)}).attr("transform","translate("+margin.left+","+margin.top+")").style("stroke",function(t){return b(t.name)});for(var p=0;p<x[0].length;p++)d3.select(x[0][p]).attr("stroke-dasharray",x[0][p].getTotalLength()+" "+x[0][p].getTotalLength()).attr("stroke-dashoffset",x[0][p].getTotalLength()).transition().duration(500).ease("linear").attr("stroke-dashoffset",0);bisectDate=d3.bisector(function(t){return t.date}).left;var k=svg.selectAll("svg").data(s).enter().append("circle").attr("fill",function(t){return b(t.name)}).attr("r",4).attr("display","none").attr("name",function(t){return t.name});svg.selectAll("circle").attr("transform",function(t){return"translate("+(margin.left+u(t.values.date))+","+(margin.top+f(t.values.number))+")"});var _=svg.append("line").attr("stroke-dasharray",10).attr("stroke","#a6a8ac").attr("stroke-width",.8).attr("display","none");svg.append("rect").attr("width",w).attr("height",h).attr("fill","none").attr("pointer-events","all").attr("transform","translate("+margin.left+","+margin.top+")").on("mouseover",function(){k.attr("display",null),_.attr("display",null),A.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mouseout",function(){k.attr("display","none"),_.attr("display","none"),A.style("opacity",0)}).on("mousemove",n);var A=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),T="<table><tbody></tbody></table>";A.html(T);var N=$("div.tooltip tbody")})}var barPadding=20,margin={top:50,bottom:50,left:120,right:300},w=$("body").width()-margin.left-margin.right,h=700-margin.top-margin.bottom,svg=d3.select("div#svg").append("svg").attr("width",w+margin.left+margin.right).attr("height",700);