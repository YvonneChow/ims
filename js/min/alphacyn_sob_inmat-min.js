$(document).ready(function(){var e=1050,a=660,t=100,r=20,n=80,u=50,s=50,l=d3.select("div#svg").append("svg").attr("width",e).attr("height",a);d3.tsv("data/localDENovartis_Apps_SoB-12_ALPHACYN_MAT.txt",function(o,v){var d=0,i=0,m=[];for(var p in v[0])m.push(p);m.splice(0,1);for(var b=[],c=[],f=0,g=0,h=0;h<m.length;h++){for(var y=0;y<v.length;y++)Number(v[y][m[h]])>=0?f+=Number(v[y][m[h]]):g+=Number(v[y][m[h]]),c.push({name:v[y].Components,number:Number(v[y][m[h]])});var x=[];x.name=c[7].name,x.number=c[7].number,c[7].name=c[0].name,c[7].number=c[0].number,c[0].name=x.name,c[0].number=x.number,f>d&&(d=f),i>g&&(i=g),f=0,g=0,b.push({date:m[h],values:c}),c=[]}console.log(b);var A=d3.scale.ordinal().domain(m).rangeRoundBands([0,e-u-s]),N=d3.svg.axis().scale(A).orient("bottom");i=100*Math.round(i/100),d=100*Math.ceil(d/100);var _=d3.scale.linear().domain([i,d]).range([a-r-n,0]),M=d3.svg.axis().scale(_).tickValues(d3.range(i,d,500)).orient("left");l.append("g").attr("class","axis").attr("transform","translate("+u+","+(a-n-(a-r-n-_(0)))+")").transition().duration(500).call(N).selectAll("text").attr("y",180),l.append("g").attr("class","axis").attr("transform","translate("+u+","+r+")").transition().duration(500).call(M);for(var Y=d3.scale.category10(),k=l.selectAll("body").data(b).enter().append("g").attr("class","item"),w=(e-u-s)/b.length-t,y=0;y<b[0].values.length;y++)k.append("rect").attr("height",0).attr("y",function(e,t){var u=0,s=0,l=a-r-n-_(0);if(e.values[y].number>=0){for(var o=0;y>o;o++)e.values[o].number>0?u=u+a-r-n-_(e.values[o].number)-l:u+=0;return s=a-n-(a-r-n-_(0))-u}if(e.values[y].number<0){for(var o=0;y>o;o++)e.values[o].number<0?u=u+a-r-n-_(-1*e.values[o].number)-l:u+=0;return s=a-n-(a-r-n-_(0))+u}}).transition().duration(function(e){var t=a-r-n-_(0);return e.values[y].number>0?a-r-n-_(e.values[y].number)-t+100:e.values[y].number<0?a-r-n-_(-1*e.values[y].number)-t+100:0}).ease("swing").delay(function(e){var t=0,u=a-r-n-_(0);if(e.values[y].number>0){for(var s=0;y>s;s++)e.values[s].number>0&&(t=t+a-r-n-_(e.values[s].number)-u+100);return t}if(e.values[y].number<0){for(var s=0;y>s;s++)e.values[s].number<0&&(t=t+a-r-n-_(-1*e.values[s].number)-u+100);return t}return 0}).attr("x",function(e,a){return u+(2*a+1)*t/2+w*a}).attr("y",function(e,t){var u=0,s=0,l=a-r-n-_(0);if(e.values[y].number>=0){for(var o=0;y>=o;o++)e.values[o].number>0?u=u+a-r-n-_(e.values[o].number)-l:u+=0;return s=a-n-(a-r-n-_(0))-u}if(e.values[y].number<0){for(var o=0;y>o;o++)e.values[o].number<0?u=u+a-r-n-_(-1*e.values[o].number)-l:u+=0;return s=a-n-(a-r-n-_(0))+u}}).attr("fill",function(e){return Y(e.values[y].name)}).attr("height",function(e,t){var u=a-r-n-_(0);return e.values[y].number>0?a-r-n-_(e.values[y].number)-u:e.values[y].number<0?a-r-n-_(-1*e.values[y].number)-u:0}).attr("width",function(e,a){return w});var B=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);B.html("<table><tbody></tbody></table>");var C=$("div.tooltip tbody");k.on("mouseover",function(e){var a=$("g.item").index(this);C.html(""),C.append("<tr><td>Time: "+b[a].date+"</td></tr>");for(var t=[],r=[],n=0;n<b[a].values.length;n++)b[a].values[n].number>0?t.push(b[a].values[n]):r.push(b[a].values[n]);for(var n=t.length-1;n>=0;n--)C.append("<tr><td><span class='color' style='background-color:"+Y(t[n].name)+"'></span><span>"+t[n].name+"</span></td><td class='value'>"+t[n].number+"</td></tr>");for(var n=0;n<r.length;n++)C.append("<tr><td><span class='color' style='background-color:"+Y(r[n].name)+"'></span><span>"+r[n].name+"</span></td><td class='value'>"+r[n].number+"</td></tr>");B.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",1)}).on("mousemove",function(e){B.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(e){B.style("opacity",0)})}),$.ajax({url:"data/localDENovartis_Apps_SoB-12_ALPHACYN_MAT.txt",success:function(e){for(var a="",t=e.split("\n"),r=0;r<t.length;r++){var n=t[r].split("	");if(0==r){for(var u=0;u<n.length;u++)a=a+"<th>"+n[u]+"</th>";$("table thead").append("<tr>"+a+"</tr>")}else{for(var u=0;u<n.length;u++)a=a+"<td>"+n[u]+"</td>";$("table tbody").append("<tr>"+a+"</tr>")}a=""}}})});